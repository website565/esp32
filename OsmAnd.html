<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OsmAnd Karta - Puna Stranica</title>
    <!-- Leaflet CSS i JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Cesium.js za 3D prikaz -->
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.110/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.110/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <style>
        body { margin: 0; padding: 0; overflow: hidden; }
        #map { height: 100vh; width: 100vw; display: none; } /* 2D mapa, puna stranica */
        #cesiumContainer { height: 100vh; width: 100vw; } /* 3D mapa, puna stranica */
        #toggleView { 
            position: fixed; 
            top: 10px; 
            left: 50%; 
            transform: translateX(-50%); 
            z-index: 1000; 
            padding: 10px 20px; 
            background: #0078A8; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            font-size: 16px; 
            cursor: pointer; 
        }
        /* Skrivanje Cesium widgeta */
        .cesium-viewer-toolbar, .cesium-viewer-animationContainer, .cesium-viewer-timelineContainer {
            display: none !important;
        }
    </style>
</head>
<body>
    <button id="toggleView" onclick="toggleView()">Prebaci na 2D</button>
    <div id="map"></div>
    <div id="cesiumContainer"></div>

    <script>
        let is3DView = true; // Početni prikaz je 3D
        let map, viewer;

        // Funkcija za prebacivanje između 2D i 3D prikaza
        function toggleView() {
            is3DView = !is3DView;
            document.getElementById('map').style.display = is3DView ? 'none' : 'block';
            document.getElementById('cesiumContainer').style.display = is3DView ? 'block' : 'none';
            document.getElementById('toggleView').innerText = is3DView ? 'Prebaci na 2D' : 'Prebaci na 3D';
            if (!is3DView) map.invalidateSize(); // Osigurava ispravan prikaz Leaflet karte nakon prebacivanja
        }

        // Inicijalizacija 2D Leaflet karte
        function initLeafletMap(lat, lng) {
            map = L.map('map', {
                zoomControl: false // Uklanja kontrolu zooma za čistiji izgled
            }).setView([lat, lng], 15);
            // OSM sloj (slično OsmAnd-u)
            const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            });
            // Satelitski sloj (Esri World Imagery)
            const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                maxZoom: 19,
                attribution: '© Esri'
            });
            // Dodavanje slojeva
            osmLayer.addTo(map);
            // Kontrola za prebacivanje slojeva
            const baseLayers = {
                "OpenStreetMap": osmLayer,
                "Satelitski prikaz": satelliteLayer
            };
            L.control.layers(baseLayers, null, { position: 'topright' }).addTo(map);
            // Marker za trenutnu lokaciju
            L.marker([lat, lng]).addTo(map).bindPopup("Vaša trenutna lokacija").openPopup();
        }

        // Inicijalizacija 3D Cesium karte
        function initCesiumMap(lat, lng) {
            Cesium.Ion.defaultAccessToken = 'YOUR_CESIUM_ION_TOKEN'; // Zamijenite s vašim Cesium Ion tokenom
            viewer = new Cesium.Viewer('cesiumContainer', {
                terrainProvider: Cesium.createWorldTerrain(), // 3D teren
                imageryProvider: Cesium.createOpenStreetMapImageryProvider(), // OSM podaci
                baseLayerPicker: true, // Omogućava biranje slojeva (OSM, satelitski)
                animation: false, // Uklanja animacijski widget
                timeline: false, // Uklanja vremensku traku
                geocoder: false, // Uklanja pretraživač
                homeButton: false, // Uklanja gumb za početnu poziciju
                navigationHelpButton: false, // Uklanja pomoćni gumb
                sceneModePicker: false, // Uklanja birač prikaza
                fullscreenButton: false // Uklanja gumb za puni zaslon
            });
            // Postavljanje kamere na trenutnu lokaciju
            viewer.camera.flyTo({
                destination: Cesium.Cartesian3.fromDegrees(lng, lat, 500),
                orientation: {
                    heading: Cesium.Math.toRadians(0),
                    pitch: Cesium.Math.toRadians(-45),
                }
            });
            // Dodavanje markera
            viewer.entities.add({
                position: Cesium.Cartesian3.fromDegrees(lng, lat),
                point: { pixelSize: 10, color: Cesium.Color.RED },
                label: { 
                    text: 'Vaša lokacija', 
                    showBackground: true, 
                    font: '14px sans-serif',
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                    pixelOffset: new Cesium.Cartesian2(0, -10)
                }
            });
        }

        // Dobivanje trenutne lokacije
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    initLeafletMap(lat, lng);
                    initCesiumMap(lat, lng);
                },
                (error) => {
                    console.error("Greška pri dohvaćanju lokacije:", error);
                    // Fallback na Zagreb ako lokacija nije dostupna
                    initLeafletMap(45.8150, 15.9819);
                    initCesiumMap(45.8150, 15.9819);
                }
            );
        } else {
            alert("Geolokacija nije podržana u vašem pregledniku.");
            // Fallback na Zagreb
            initLeafletMap(45.8150, 15.9819);
            initCesiumMap(45.8150, 15.9819);
        }
    </script>
</body>
</html>